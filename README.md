# jisc-wrangler
A command line tool for restructuring data in the JISC 19th Century British Library Newspaper collection.

:construction: This tool is under construction :construction:


##  Prerequisites :paperclip:

- Python >= 3.8
- [poetry](https://python-poetry.org/docs/)

##  Installation :gear:

1. Clone this repo: `git clone https://github.com/Living-with-machines/jisc-wrangler.git`
2. Navigate into the repo: `cd jisc-wrangler`
3. Initialise a poetry shell: `poetry shell`
4. Install dependencies: `poetry install`

##  Usage :clipboard:

### jisc_plain_wrangler

[jisc_plain_wrangler.py](jisc_wrangler/jisc_plain_wrangler.py) is a command line tool for restructuring mangled and duplicated [JISC](https://www.jisc.ac.uk/full-guide/metadata) newspaper XML file paths. The tool takes an input directory (`input_dir`) that contains mangled JISC data file paths, restructures it and saves the output to a new location (`output_dir`).

```bash
python jisc_plain_wrangler.py /path/to/input/dir /path/to/output/dir
```

[jisc_plain_wrangler.py](jisc_wrangler/jisc_plain_wrangler.py) will produce temporary files and a log file as it runs, the locations of which can be set using the `--working_dir` argument.

For a full list of runtime parameters, run `python jisc_plain_wrangler.py --help`.

#### Walk through

Say you have some XML data saved in a file called `WO1_BNWL_1874_01_01-0001-001.xml`. This represents a standard and logical way of organising newspaper XML files based on their publication dates. However, in many cases these files are stored on mangled file paths. This file, for examle, is stored at:

`'0001_Job2001-Final Delivery   12$17$2006 at 12$49 PM/0001_$$Fileserver7$disk15$Job2001-masterfiles/2001-0289/Delivery/WO1/BNWL/1874/01/01/service/WO1_BNWL_1874_01_01-0001-001.xml'`

Aside from the white spaces and special characters, the directory structure is convoluted and unnecessary, whilst the filename is consistent and appropriatley named. [jisc_plain_wrangler.py](jisc_wrangler/jisc_plain_wrangler.py) reconstructs these paths based on the information in the file names and copies the file to this location, leaving the original structure in place.

Say this file path is located in a directory called `jisc-input`, [jisc_plain_wrangler.py](jisc_wrangler/jisc_plain_wrangler.py) will find the file and save it under a new path in a specificed output directory:

```bash
python jisc_plain_wrangler.py jisc-input jisc-output --working_dir jisc-logs
```

The output in the terminal looks like this:

```python
>>> This is JISC Wrangler <<<
Logging to the current directory at:
%s /jisc-logs/jw.log
Processing 1 unique title code directory...
100%|█████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 358.21it/s]
```

The input directory, `jisc-input` remains unaltered, whilst the previously empty directory `jisc-output` now has the file name as the directory structure:

```bash
jisc-output/
└── BNWL
    └── 1874
        └── 01
            └── 01
                └── WO1_BNWL_1874_01_01-0001-001.xml

4 directories, 1 file
```

`jisc-logs` now contains a log file and a directory contining the running logs with the date and time the command was ran:

```bash
jisc-logs/
├── jw.log
└── jw_2023-03-30_11h-12m-10s

1 directory, 1 file
```

- `jw.log` logs every action [jisc_plain_wrangler.py](jisc_wrangler/jisc_plain_wrangler.py) made
- `jw_yyyy-mm-dd_hh-mm-ss` contains three possible output files:
    - `unmathced.txt`: lists files that do not match any of the directory patterns.
    - `ignored.txt` : lists files that are ignored by [jisc_plain_wrangler.py](jisc_wrangler/jisc_plain_wrangler.py).
    - `duplicates.txt` : lists files that have already been processed and are in the output directory.

Note: in this exaple these files are empty and so have not been created.


Now the file paths have been restructued, `jisc_alto2txt_wrangler.py` can go to work on the XML contents.


### jisc_alto2txt_wrangler

[jisc_alto2txt_wrangler.py](jisc_wrangler/jisc_alto2txt_wrangler.py) is a command line tool for replacing 4-character title codes with 7-digit NLP codes in the metadata XML files generated by executing `alto2txt` on the output produced by `jisc_plain_wrangler.py`. Only the XML content of the _metadata.xml files produced by `alto2txt` is modified. Specifically, the value of the "id" attribute associated with the "publication" element is changed from a **4-character title** code to a **7-digit NLP code**.File structure and names are unchanged (i e. duplicated in the output), to ensure that paths and files quoted to in the metadata XML remain valid.
